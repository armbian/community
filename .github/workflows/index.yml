name: "Generating index"
on:

  workflow_dispatch:

env:
   GH_TOKEN: ${{ secrets.CR_PAT }}

jobs:

  jobsend:

    name: "Create index"
    runs-on: ubuntu-latest
    if: ${{ github.repository_owner == 'Armbian' }}
    steps:

      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Get releases
        uses: armbian/actions/make-json@main
        with:
          repository: "community"
          filename: "generic"
          key: ${{ secrets.KEY_TORRENTS }}
          known_hosts: ${{ secrets.KNOWN_HOSTS_UPLOAD }}
          grep: "Uefi,Rpi4b"

      - name: Get releases
        uses: armbian/actions/make-json@main
        with:
          repository: "community"
          filename: "optimised"
          key: ${{ secrets.KEY_TORRENTS }}
          known_hosts: ${{ secrets.KNOWN_HOSTS_UPLOAD }}
          grep: "-v Uefi,Rpi4b"


      - name: Make build list
        run: |

          cat json/generic.md
          cat json/optimised.md
